import"./auth-flow-sso-buttons-4226397a.js";import{W as t,a as e,_ as s,n as i,b as o,c as n,e as r,l as a,aO as l,m as d,v as h,a3 as c,aP as p,E as u,r as m,aa as b,aA as v,q as f,aQ as g,aR as y,j as w}from"./shell-676e2013.js";import{s as k,x as S,i as O}from"./icon-8c4e3009.js";import{A as x}from"./app-link-e629b478.js";import{b as A,B as C}from"./xpromo-459331ff.js";import{W as j}from"./with-sso-linking-49777eab.js";import{t as I}from"./xpromoConsolidationLsData-d688e24d.js";import{O as _,D as E}from"./constants-d39b7803.js";import"./shreddit-slotter-28d219a3.js";import"./faceplate-tabpanel-561190a1.js";import"./auth-flow-modal-652aa70a.js";import"./auth-text-input-83b94b62.js";import{C as L}from"./cbau-2ec10a62.js";import"./auth-flow-controller-40cc9e82.js";import"./reload-to-logged-in-99dc44b4.js";import"./index-386a36f1.js";import"./scroll-blocker-3d1f9fde.js";import"./index-99537bc7.js";import"./contextualSignupPrompt-e2b45125.js";import"./google-api-10e80383.js";import"./load-lazy-script-with-nonce-91b572d7.js";import"./light-dom-slot-controller-0b9fcecb.js";import"./with-recaptcha-1a8233a2.js";import"./faceplate-form-745213bf.js";import"./form-common-utils-450ddffa.js";import"./auth-flow-sso-linking-95ef66e2.js";import"./helpers-0144f681.js";import"./faceplate-text-input-b587df82.js";import"./live-dfde7187.js";import"./text-input-2f7ff360.js";import"./faceplate-input-24154400.js";import"./input-element-c1862430.js";import"./auth-flow-link-b243231c.js";import"./a-bef4fc0c.js";import"./pageable-832f4cce.js";const T=t(k);let B=class extends T{constructor(){super(...arguments),this.appLinkParams={},this._appLinkController=new x(this)}onOpenClick(){const t=A(C.GetApp);this.trackEvent(t),this._appLinkController.handleOpenInAppClick()}renderAppLinkButton(){const t=this._appLinkController.getAppLink(this.appLinkParams);return S` ${o({appearance:"brand",size:n.Medium,attributes:{className:"w-full",href:t,rel:"nofollow",id:"primary-button",onclick:this.onOpenClick},children:"Open this post in the app"})} `}render(){return S`<div class="text-center px-md xs:px-0 mb-xl"> <slot name="title"></slot>${this.renderAppLinkButton()}<slot></slot> </div>`}};B.styles=[e],s([i({type:Object,attribute:"app-link-params"})],B.prototype,"appLinkParams",void 0),B=s([r("auth-flow-inline-app-target")],B);const F=t=>a({source:"onboarding",action:"view",noun:"upsell_unit"},{action_info:{page_type:t}}),R=()=>a({source:"onboarding",action:"click",noun:"upsell_unit"},{action_info:{type:"not_now"}}),M=new Set(l.map((t=>d({source:_,action:E,noun:t})))),X=t(h(j(k,c.InlineUpsell)));let P=class extends X{get shredditSlotterElm(){return this.shadowRoot?.querySelector("shreddit-slotter")}get bottomSheet(){return this.shredditSlotterElm?.shadowRoot?.querySelector("#inline-auth-upsell-bottom-sheet-modal")}get isInlineRendered(){return this.shredditSlotterElm?.getAttribute("slot-name")===p.InlineAuthLandingExperienceXpromo}constructor(){super(),this.isOverlay=!1,this.events=new u(this),this._authFlowModalOpen=!1,this._cachedYScrollPosition=0,this.mounted=!1,this.pubSubController=new m(this),this.cacheCurrentScrollPosition=()=>{this.isInlineRendered&&(this._cachedYScrollPosition=window.scrollY||window.pageYOffset)},this.debouncedCacheCurrentScrollPosition=b(this.cacheCurrentScrollPosition,300),this._handleDismissButtonClick=()=>{this.trackEvent(R()),this.bottomSheet?.close(),this._unmount()},this.onShredditSlotterNameChanged=this.events.define("shreddit-slotter-slot-name-changed",(t=>{this.onSlotterRouteChange(t.detail.slotName)})),this.onAccountManagerDismissed=this.events.define("accountmanager-dismissed",this.switchToInlineXpromo),this._onAuthFlowModalOpen=this.events.define(v.Open,(()=>{this._authFlowModalOpen=!0,this.setIsOverlayAttr()})),this.onFaceplateTrack=this.events.define("faceplate-track",(t=>{t.SAN&&M.has(t.SAN)&&(this._authFlowModalOpen=!1,this.setIsOverlayAttr(),this.switchToInlineXpromo())})),this.pubSubController.subscribe(f.TriggerCommentBlockingAuth,(t=>this.openBottomSheet(t)),!1)}connectedCallback(){super.connectedCallback(),this.isObserved||this.enableObserver({threshold:.8}),document.addEventListener("scroll",this.debouncedCacheCurrentScrollPosition,{passive:!0})}disconnectedCallback(){super.disconnectedCallback(),this.isObserved&&this.disableObserver(),document.removeEventListener("scroll",this.debouncedCacheCurrentScrollPosition)}bindDismissButtonListener(){const t=this.shredditSlotterElm?.shadowRoot?.querySelector("#inline-auth-upsell-bottom-sheet-modal-close");t?.addEventListener("click",this._handleDismissButtonClick)}updated(t){super.updated(t);!0===t.get("isOverlay")&&this.onReturnFromOverlay()}onReturnFromOverlay(){setTimeout((()=>{window.scrollTo(0,this._cachedYScrollPosition)}),0)}_unmount(){this.remove()}switchToInlineXpromo(){this.shredditSlotterElm?.setAttribute("slot-name",p.InlineAuthLandingExperienceXpromo)}openBottomSheet({source:t}){this.triggerType===t&&this.bottomSheet?.show()}observerIsIntersectingCallback(){if(this.disableObserver(),this.mounted)return;this.mounted=!0,I();const t=g()??y.Unknown;this.trackEvent(F(t))}setIsOverlayAttr(){const t=this.shredditSlotterElm?.getAttribute("slot-name");this.isOverlay=this._authFlowModalOpen||t!==p.InlineAuthLandingExperienceXpromo}onSlotterRouteChange(t){t===p.InlineAuthLandingExperienceXpromo&&this.bindDismissButtonListener(),this.setIsOverlayAttr()}renderAuthFlowTemplate(){const t=this.querySelector('template[slot="auth-flow"');return t instanceof HTMLTemplateElement?w(t):""}render(){return S` <div class="${"relative block -mt-3xl z-10 bg-neutral-background shadow-[0px_-40px_21px_var(--color-neutral-background)]"}">${super.render()} ${this.renderAuthFlowTemplate()}</div> `}};P.styles=[O`:host([is-overlay]){display:block;position:relative;z-index:100}`,e],s([i({type:Boolean,attribute:"is-overlay",reflect:!0})],P.prototype,"isOverlay",void 0),s([i({type:String,attribute:"trigger-type"})],P.prototype,"triggerType",void 0),P=s([r("inline-auth-landing-experience-xpromo-shell")],P);const D=new Set(l.map((t=>d({source:_,action:E,noun:t})))),q=t(h(j(k,c.InlineUpsell)));let Y=class extends q{constructor(){super(...arguments),this.isOverlay=!1,this.events=new u(this),this.isSlim=!1,this.isVisible=!1,this._authFlowModalOpen=!1,this.mounted=!1,this.pubSubController=new m(this),this._handleDismissButtonClick=()=>{this.trackEvent(R()),this._unmount()},this.onShredditSlotterNameChanged=this.events.define("shreddit-slotter-slot-name-changed",(t=>{this.onSlotterRouteChange(t.detail.slotName)})),this.onAccountManagerDismissed=this.events.define("accountmanager-dismissed",this.switchToInlineXpromo),this._onAuthFlowModalOpen=this.events.define(v.Open,(()=>{this._authFlowModalOpen=!0,this.setIsOverlayAttr()})),this.onFaceplateTrack=this.events.define("faceplate-track",(t=>{t.SAN&&D.has(t.SAN)&&(this._authFlowModalOpen=!1,this.setIsOverlayAttr(),this.switchToInlineXpromo())})),this.hideOrShow=({source:t})=>{t===L.Scroll?this.isVisible=!0:t===L.Close&&(this.isVisible=!1)}}get shredditSlotterElm(){return this.shadowRoot?.querySelector("shreddit-slotter")}get wrapper(){return this.shadowRoot?.querySelector(".wrapper")}get isInlineRendered(){return this.shredditSlotterElm?.getAttribute("slot-name")===p.InlineAuthLandingExperienceXpromo}connectedCallback(){super.connectedCallback(),this.pubSubController.subscribe(f.TriggerCommentBlockingAuth,this.hideOrShow,!1),this.isObserved||this.enableObserver({threshold:.8})}disconnectedCallback(){super.disconnectedCallback(),this.isObserved&&this.disableObserver(),this.pubSubController.unsubscribe(f.TriggerCommentBlockingAuth,this.hideOrShow)}bindButtonListener(){const t=this.shredditSlotterElm?.shadowRoot?.querySelector("#desktop-cbau-close-button");t?.addEventListener("click",this._handleDismissButtonClick)}updated(t){super.updated(t);if(!0===t.get("isOverlay")||t.has("isVisible")){const t=this.shadowRoot.querySelector(".content");this.isVisible?(t.classList.remove("fade-out","hidden"),t.classList.add("fade-in")):(t.classList.remove("fade-in"),t.classList.add("fade-out"))}}_unmount(){this.remove()}switchToInlineXpromo(){this.shredditSlotterElm?.setAttribute("slot-name",p.InlineAuthLandingExperienceXpromo)}observerIsIntersectingCallback(){if(this.disableObserver(),this.mounted)return;this.mounted=!0,I();const t=g()??y.Unknown;this.trackEvent(F(t))}setIsOverlayAttr(){const t=this.shredditSlotterElm?.getAttribute("slot-name");this.isOverlay=this._authFlowModalOpen||t!==p.InlineAuthLandingExperienceXpromo}onSlotterRouteChange(t){t===p.InlineAuthLandingExperienceXpromo&&this.bindButtonListener(),this.setIsOverlayAttr()}renderAuthFlowTemplate(){const t=this.querySelector('template[slot="auth-flow"');return t instanceof HTMLTemplateElement?w(t):""}onAnimationEnd(){this.isVisible||this.shadowRoot?.querySelector(".content")?.classList.add("hidden")}render(){return S` <div class="content ${this.isOverlay?"":"wrapper sticky -ml-md -mr-xs mt-[-65vh] bottom-0 z-[100] hidden"}" @animationend="${this.onAnimationEnd}"> <div class="${this.isOverlay?"":"container p-2xl pb-lg h-[auto] min-h-[65vh] justify-items-end relative flex items-end box-border"}"> <div class="w-100 h-100 absolute z-0 left-0 bottom-0 ${this.isOverlay?"hidden":"overlay"}"></div> <div class="relative z-10 max-w-100 bg-neutral-background-strong ${this.isSlim?"rounded-[12px] border-[1px] border-neutral-border border-solid":"rounded-[16px]"} shadow-md mx-auto pointer-events-auto box-border"> ${this.renderAuthFlowTemplate()} </div> </div> </div>`}};Y.styles=[O`:host{pointer-events:none}:host([is-overlay]){display:block;position:relative;z-index:100;pointer-events:all}@keyframes fadeInSlideUp{0%{display:none;opacity:0;transform:translateY(50px)}1%{display:block;opacity:0;transform:translateY(50px)}100%{display:block;opacity:1;transform:translateY(0)}}@keyframes fadeOutSlideDown{0%{display:block;opacity:1;transform:translateY(0)}99%{display:block;opacity:0;transform:translateY(50px)}100%{display:none;opacity:0;transform:translateY(50px)}}.fade-in{animation:fadeInSlideUp .8s ease forwards}.fade-out{animation:fadeOutSlideDown .8s ease forwards}.hidden{display:none}.wrapper{margin-top:-65vh}.container{min-height:65vh}.overlay{background:linear-gradient(0deg,var(--color-neutral-background) 10%,rgba(0,0,0,0) 100%)}`,e],s([i({type:Boolean,attribute:"is-overlay",reflect:!0})],Y.prototype,"isOverlay",void 0),s([i({type:Boolean,attribute:"slim"})],Y.prototype,"isSlim",void 0),s([i({type:Boolean})],Y.prototype,"isVisible",void 0),Y=s([r("auth-landing-experience-xpromo-cbau-wrapper")],Y);
//# sourceMappingURL=xpromo-inline-auth-upsell-client-js-488db45b.js.map
