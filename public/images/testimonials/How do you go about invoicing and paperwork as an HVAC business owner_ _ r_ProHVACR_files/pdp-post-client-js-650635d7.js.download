import"./shreddit-post-d353da7a.js";import"./shreddit-post-flair-34e41973.js";import"./faceplate-progress-934ab1f3.js";import"./follow-button-13146df6.js";import"./mod-note-overflow-menu-536abf8f.js";import"./achievements-entrypoint-8437bc5f.js";import"./reddit-chat-anchor-f6dff24e.js";import"./click-location-tracker-ceb6490b.js";import{_ as t,t as e,n as s,e as i,co as a,eA as o,ey as r,eu as n,bw as l,eK as d,dR as c,ez as p,I as u,eD as m,g as h,eE as b,eB as f,a as T,b as S,c as j,br as g}from"./shell-676e2013.js";import{B as C}from"./base-translator-bede122f.js";import"./translation-feedback-modal-96926de9.js";import{x as y,s as v,A,c2 as M,I as x,d9 as k,i as I}from"./icon-8c4e3009.js";import"./shreddit-post-translator-0d348d94.js";import"./pdp-back-button-0e2a408e.js";import{a as E}from"./ama-859a7489.js";import{p as P}from"./pluralize-6ac540cf.js";import"./faceplate-timeago-7cafbe56.js";import"./community-achievements-flair-eeef6b05.js";import"./faceplate-date-7a4e1121.js";import"./locale-e49f0b05.js";import"./faceplate-number-fad7f0f7.js";import"./number-ea0536b9.js";import"./cached-intl-e5b35306.js";import"./index-c1992690.js";import"./content-action-button-aef32c2f.js";import"./award-controller-8d9a9716.js";import"./awardsTelemetryState-d4244887.js";import"./accessibility-cookie-utils-35d9d1cc.js";import"./award-14de0936.js";import"./index-1371b3a5.js";import"./utils-9210808e.js";import"./rpl-tooltip-563a3363.js";import"./contains-1042b204.js";import"./interaction-controller-daa20b2e.js";import"./mod-actions-controller-dae0112a.js";import"./list-item-e0968412.js";import"./custom-event-8a5c1c61.js";import"./add-removal-reason-modal-51851fd9.js";import"./utils-147dae00.js";import"./modActions-878c72fa.js";import"./keyed-ffbf74b7.js";import"./faceplate-form-745213bf.js";import"./form-common-utils-450ddffa.js";import"./comment-b3d4941e.js";import"./modActions-479f5b52.js";import"./postUpdate-613ece2a.js";import"./post-0ca6bc76.js";import"./post-ba5a10bc.js";import"./faceplate-input-24154400.js";import"./input-element-c1862430.js";import"./dropdownButton-c14ba005.js";import"./faceplate-dropdown-menu-c0544483.js";import"./popper-controller-b048cf6c.js";import"./makeEventDispatcher-28989282.js";import"./faceplate-menu-1a383f12.js";import"./faceplate-modal-2d019896.js";import"./faceplate-textarea-input-899c007a.js";import"./live-dfde7187.js";import"./text-input-2f7ff360.js";import"./remove-highlighted-post-bd327ce4.js";import"./pdp-a697afbf.js";import"./throttle-cde4a556.js";import"./faceplate-shimmer-1c7d38ee.js";import"./click-card-8ed7c255.js";import"./faceplate-hovercard-941a58fe.js";import"./faceplate-tooltip-c8f30589.js";import"./post-guidance-feedback-52ade58f.js";import"./shreddit-content-tags-1c041b6a.js";import"./content-tags-0e484542.js";import"./shreddit-post-share-button-bba8a201.js";import"./with-share-bf814598.js";import"./a-bef4fc0c.js";import"./index-6b6f75e3.js";import"./faceplate-carousel-916cdd22.js";import"./TinyGesture-6f7cc1aa.js";import"./badge-669f9d6c.js";import"./expandable-mod-reports-base-bc02bec4.js";import"./outbound-link-tracking-controller-c5dfa067.js";import"./promote-post-button-e00c7389.js";import"./utils-8ed67e8a.js";import"./translation-intervention-modal-81401c04.js";import"./translations-d2a1922a.js";import"./faceplate-bottom-sheet-7f90aa1b.js";import"./events-a107d019.js";import"./shreddit-rpl-action-bar-update-3bbb9074.js";import"./overflow-menu-actions-35c078f4.js";import"./shreddit-overflow-report-f4ac9a26.js";import"./v2-events-a322d427.js";import"./classnameUtils-e77f7123.js";import"./mod-verdict-02ce545e.js";import"./index-b5439860.js";import"./achievements-b1f3d76c.js";import"./track-ad-click-9e39f788.js";import"./faceplate-banner-a0cf6493.js";import"./relative-date-77173042.js";import"./achievement-modal-2cd9b6ca.js";import"./tab-button-5b216abd.js";import"./tab-9862f97a.js";import"./utils-9a347755.js";const D={TITLE:"title",TEXT_BODY:"text-body",TRANSLATION_SUFFIX:"-translated",TRANSLATION_ERROR:"#post-translation-error",STILL_IMAGE:`.${f}`,MEDIA_URL:"#media-url",MEDIA_FULLSIZE_URL:"#media-fullsize-url",SRC_SET:"#src-set",ZOOMABLE_IMG:"zoomable-img"};let q=class extends C{constructor(){super(),this.translatorChildrenName="shreddit-post",this.seoVisitSettled=!1,this.isSeoVisit=!1,this.translationState={originalMediaSrcset:"",originalMediaUrl:"",originalMediaFullsizeUrl:"",translatedMediaUrl:"",translatedMediaSrcset:"",translatedMediaFullsizeUrl:""},this._partialRequest=new a(this)}connectedCallback(){super.connectedCallback();const t=this.querySelector(this.translatorChildrenName);t&&this.translationContextValue.isTranslationActive&&t.isPostTranslated&&this.trackEvent(this,o(t,!0)),this.addEventListener(r,this.handleTranslationFeedback)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}handleTranslationFeedback(t){const e=this.translationContextValue.isTranslationActive,s=this.querySelector(this.translatorChildrenName),i=s?.id,a=s?.querySelector(e?'[slot="title-translated"]':'[slot="title"]'),o=s?.querySelector(e?'[slot="text-body-translated"]':'[slot="text-body"]'),r=this.shadowRoot?.getElementById(n.ID.PDP_POST_FEEDBACK_MODAL);r&&r.show?.({post:{id:i,title:a?.textContent?.trim(),body_text:o?.textContent?.trim(),translation_state:e}})}async onTranslationsEnabled(){this.togglePostTranslations(!0),this.submitTranslationMetrics()}async onTranslationsDisabled(){this.togglePostTranslations(!1),this.submitTranslationMetrics()}async togglePostTranslations(t){const e=this.findTranslatablePost(t);if(!e)return this.logError({error:"post not found"});if(e.isTranslationFetched)return this.trackEvent(this,o(e,t)),this.toggleMediaTranslation(t),void(e.isPostTranslated=t);if(!e.isTranslatable&&e.postType!==l.Image)return;const s=await this.loadPostTranslations(e,t);if(!(s&&!1===s.includes?.(d)))return this.logError({error:"api error",metadata:{id:e.id,isTranslationActive:t}});e.isTranslatable&&this.trackEvent(this,o(e,t));const i=c(s);this.appendResponseToPost(e,i),this.storeMediaResponseToCache(i,t),this.toggleMediaTranslation(t)}findTranslatablePost(t){const e=this.querySelector(this.translatorChildrenName);if(!(!e||e.isPostTranslated&&t))return e}async loadPostTranslations(t,e){if(t.isTranslatable||t.postType===l.Image){const s=e?p.GetTranslation:p.GetOriginal,i=new FormData;i.append("postId",t.id),i.append("translationState",s),t.isTranslatable&&i.append("isTranslatable","true");const a="/svc/shreddit/translated-post/";return(await this._partialRequest.request(a,{method:u.Post,body:i}))?.text()}}appendResponseToPost(t,e){if(!t.isTranslatable)return;let s=!1;const i=t.isPostTranslated?[D.TITLE,D.TEXT_BODY]:[`${D.TITLE}${D.TRANSLATION_SUFFIX}`,`${D.TEXT_BODY}${D.TRANSLATION_SUFFIX}`];e.forEach((e=>{const a=e.getAttribute("slot")||"";a.includes(D.TEXT_BODY)&&this.isDevPlatformPost()||i.includes(a)&&!t.querySelector(`[slot="${a}"]`)&&(t.appendChild(e),s=!0)})),s&&(t.isTranslationFetched=!0,this.translationContextValue.isTranslationActive?(t.isPostTranslated=!0,t.isPostBodyTranslated=!0):(t.isPostTranslated=!1,t.isPostBodyTranslated=!1))}storeMediaResponseToCache(t,e){const s=document.querySelector(D.STILL_IMAGE),i=document.querySelector(D.ZOOMABLE_IMG)?.querySelector("img");let a,o,r;t.forEach((t=>{t.id===D.MEDIA_URL.slice(1)&&(a=t.textContent||""),t.id===D.SRC_SET.slice(1)&&(r=t.textContent||""),t.id===D.MEDIA_FULLSIZE_URL.slice(1)&&(o=t.textContent||"")})),a&&r&&(e?(this.translationState.originalMediaUrl=s?.getAttribute("src")||"",this.translationState.originalMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.originalMediaFullsizeUrl=i?.getAttribute("src")||"",this.translationState.translatedMediaUrl=a,this.translationState.translatedMediaSrcset=r,this.translationState.translatedMediaFullsizeUrl=o??""):(this.translationState.originalMediaUrl=a,this.translationState.originalMediaSrcset=r,this.translationState.originalMediaFullsizeUrl=o??"",this.translationState.translatedMediaUrl=s?.getAttribute("src")||"",this.translationState.translatedMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.translatedMediaFullsizeUrl=i?.getAttribute("src")||""))}toggleMediaTranslation(t){if(!this.isMediaCacheStored())return;const e=document.querySelector(D.STILL_IMAGE),s=document.querySelector(D.ZOOMABLE_IMG)?.querySelector("img");t?(e?.setAttribute("src",this.translationState.translatedMediaUrl),e?.setAttribute("srcset",this.translationState.translatedMediaSrcset),s?.setAttribute("src",this.translationState.translatedMediaFullsizeUrl)):(e?.setAttribute("src",this.translationState.originalMediaUrl),e?.setAttribute("srcset",this.translationState.originalMediaSrcset),s?.setAttribute("src",this.translationState.originalMediaFullsizeUrl))}isMediaCacheStored(){return!!this.translationState.translatedMediaUrl&&!!this.translationState.originalMediaUrl}isDevPlatformPost(){return null!==this.querySelector("shreddit-devvit-ui-loader")}submitTranslationMetrics(){if(!this.reportMetrics)return;const t=this.querySelector("shreddit-post");if(!t)return;const{id:e,postType:s="",isPostTranslated:i,isTranslatable:a,isPostBodyTranslated:o}=t,r=this.translationContextValue?.isTranslationActive||!1,n={},l=t.querySelector('[slot="title"')?.textContent||"",d=t.querySelector('[slot="title-translated"')?.textContent||"",c=t.querySelector('[slot="text-body"]')?.textContent||"",p=t.querySelector('[slot="text-body-translated"]')?.textContent||"",u=""!==c||""!==p;n.scenario=this.metricsScenario,n.targetLanguage=t.translationLanguage,n.post=m({postId:e,postType:s,translationSetting:r,originalTitle:l,translatedTitle:d,originalBody:c,translatedBody:p,isTitleTranslated:i,isBodyTranslated:u?o:i,isTranslatable:a}),this.dispatchEvent(h(b,n))}render(){return y` <div><slot></slot></div> <translation-feedback-modal id="${n.ID.PDP_POST_FEEDBACK_MODAL}"></translation-feedback-modal> `}};t([s({type:Boolean,attribute:"is-seo-visit"})],q.prototype,"isSeoVisit",void 0),t([e()],q.prototype,"translationState",void 0),q=t([i("post-translator")],q);let w=class extends v{constructor(){super(...arguments),this.isSetup=!1,this.hasPrevious=!1,this.hasNext=!1,this.feedData=[],this.currentIndex=-1,this.setup=()=>{const t=Array.from(document.querySelectorAll("[slot=mod-queue-feed] mod-queue-list-item, [slot=mod-queue-feed] shreddit-post, [slot=mod-queue-feed] shreddit-profile-comment")).map((t=>t.getAttribute("comment-id")||t.getAttribute("id"))).filter(Boolean);t.length>0&&(this.feedData=t,this.currentIndex=this.feedData.findIndex((t=>t===this.thingId)),this.hasPrevious=this.currentIndex>0,this.hasNext=this.currentIndex+1<this.feedData.length,this.isSetup=!0)},this.handlePreviousBtnClick=()=>{const t=this.feedData[this.currentIndex-1];document.querySelector(`[slot=mod-queue-feed] mod-queue-list-item[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-post[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-profile-comment[comment-id="${t}"] *`)?.click()},this.handleNextBtnClick=()=>{const t=this.feedData[this.currentIndex+1];document.querySelector(`[slot=mod-queue-feed] mod-queue-list-item[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-post[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-profile-comment[comment-id="${t}"] *`)?.click()}}connectedCallback(){super.connectedCallback(),this.setup()}render(){return this.isSetup?y`<div class="flex"> ${S({appearance:"plain",attributes:{type:"button","aria-label":"Previous post",disabled:!this.hasPrevious,onclick:this.handlePreviousBtnClick},leadingIcon:M({size:x.Small}),size:j.Small})} ${S({appearance:"plain",attributes:{type:"button","data-label":"pdp-post-close","aria-label":"Next post",disabled:!this.hasNext,onclick:this.handleNextBtnClick},leadingIcon:k({size:x.Small}),size:j.Small})} </div>`:A}};w.styles=[T],t([s({type:String,attribute:"thing-id"})],w.prototype,"thingId",void 0),t([e()],w.prototype,"isSetup",void 0),t([e()],w.prototype,"hasPrevious",void 0),t([e()],w.prototype,"hasNext",void 0),t([e()],w.prototype,"feedData",void 0),t([e()],w.prototype,"currentIndex",void 0),w=t([i("mod-queue-pdp-pagination-buttons")],w);let _=class extends v{constructor(){super(...arguments),this.isVisible=!1,this.handleScroll=t=>{const e=t.target.scrollTop;this.isVisible=e>60}}connectedCallback(){super.connectedCallback();this.closest('[slot="pdp-panel"]')?.addEventListener("scroll",this.handleScroll)}disconnectedCallback(){super.disconnectedCallback();this.closest('[slot="pdp-panel"]')?.removeEventListener("scroll",this.handleScroll)}render(){return this.isVisible?y`<div class="bg-neutral-background z-[2] flex justify-end absolute right-md shadow-md p-2xs rounded-full mt-sm"> <slot name="pagination"></slot> <slot name="close"></slot> </div>`:A}};_.styles=[T],t([e()],_.prototype,"isVisible",void 0),_=t([i("mod-queue-pdp-floating-ctas")],_);let L=class extends v{constructor(){super(...arguments),this.isMobile=!1,this.showDurationS=8,this.postId="",this.isPillVisible=!1,this.hostCommentCount=0,this.isAddedTabEvent=!1,this.commentCountSubscriptionController=new g(this),this.onData=t=>{this.isAddedTabEvent||(document.querySelector(`.${E}`)?.addEventListener("click",this.handleAmaCommentTabClick),this.isAddedTabEvent=!0);const e=t.subscribe.data.hostCommentCountChange||0;e<=0||(this.hostCommentCount+=e,this.isPillVisible?clearTimeout(this.currentCountDown):this.isPillVisible=!0,this.currentCountDown=setTimeout((()=>{this.isPillVisible=!1}),1e3*this.showDurationS))},this.scrollToCommentsAndRefreshAnswers=()=>{const t=document.querySelector(`.${E}`)?.offsetTop;if(!t)return;const e=document.querySelector("nav")?.offsetHeight??0;window.scrollTo({top:t-e,behavior:"smooth"});document.querySelector('button[value="answered"]')?.click()},this.onPillClick=()=>{this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown),this.currentCountDown=void 0,this.scrollToCommentsAndRefreshAnswers()},this.handleAmaCommentTabClick=t=>{const e=t.target?.getAttribute("value"),s=e&&e.toLowerCase();"all"!==s&&"answered"!==s||(this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown))}}static get styles(){return[I`:host{left:50%;position:fixed;top:calc(var(--shreddit-header-height) + 32px);transform:translateX(-50%);z-index:1001}`,T]}getTitleText(){const t=this.hostCommentCount;return P({count:t,single:`${t} new answer`,many:`${t} new answers`})}connectedCallback(){super.connectedCallback(),this.commentCountSubscriptionController.subscribe({query:{operationName:"SubscribeSubscription",query:"\n          subscription SubscribeSubscription($input: SubscribeInput!) {\n            subscribe(input: $input) {\n              ... on BasicMessage {\n                data {\n                  ... on CommentCountUpdateMessageData {\n                    hostCommentCountChange\n                  }\n                }\n              }\n            }\n          }\n          ",variables:{input:{channel:{teamOwner:"CONTENT_AND_COMMUNITIES",category:"COMMENT_COUNT_UPDATE",postID:this.postId}}}},onData:t=>{t.data&&this.onData(t.data)}})}disconnectedCallback(){super.disconnectedCallback(),document.querySelector(`.${E}`)?.removeEventListener("click",this.handleAmaCommentTabClick)}render(){return this.isPillVisible?S({appearance:"primary",attributes:{onclick:this.onPillClick},children:this.getTitleText(),size:this.isMobile?j.Small:j.Large,role:"button"}):A}};t([s({type:Boolean,attribute:"is-mobile"})],L.prototype,"isMobile",void 0),t([s({type:Number,attribute:"show-duration-in-s"})],L.prototype,"showDurationS",void 0),t([s({type:String,attribute:"post-id"})],L.prototype,"postId",void 0),t([e()],L.prototype,"isPillVisible",void 0),t([e()],L.prototype,"hostCommentCount",void 0),L=t([i("ama-new-comment-pill")],L);
//# sourceMappingURL=pdp-post-client-js-650635d7.js.map
