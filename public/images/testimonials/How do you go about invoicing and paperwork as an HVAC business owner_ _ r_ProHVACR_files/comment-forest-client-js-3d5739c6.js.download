import{s as t,x as e,C as s,I as n,i,A as o,aZ as r,f as a,bo as l,cY as c}from"./icon-8c4e3009.js";import{W as d,_ as m,n as h,e as p,am as u,q as b,a as v,d as f,hq as g,v as C,hr as y,l as w,f as S,t as _,bZ as k,b8 as T,hs as I,dR as A,bF as x,c8 as E,b as j,c as P,bd as L,r as O,co as M,gh as D,ht as V,hu as U,I as $,eu as q,hv as B,g as R,hw as F,ex as N,e7 as z,e8 as Q,k as H,w as J,hx as W,hy as K,aa as Z,hz as G,hA as Y,cc as X,aR as tt,hB as et,o as st,cl as nt,cm as it,ev as ot,cn as rt}from"./shell-676e2013.js";import{c as at,o as lt}from"./index-aee216de.js";import{t as ct}from"./throttle-cde4a556.js";import{C as dt}from"./cbau-2ec10a62.js";import{d as mt,R as ht}from"./shreddit-overflow-report-f4ac9a26.js";import{S as pt}from"./scroll-blocker-3d1f9fde.js";import{t as ut}from"./comments-7a611a30.js";import"./shreddit-spoiler-8f9c3a1d.js";import"./faceplate-render-f9771af5.js";import"./community-achievements-flair-eeef6b05.js";import"./author-flair-event-handler-ee32e955.js";import{B as bt}from"./base-translator-bede122f.js";import"./translation-feedback-modal-96926de9.js";import{g as vt}from"./post-0ca6bc76.js";import"./translation-intervention-modal-81401c04.js";import"./shreddit-comment-badges-c856a1d2.js";import"./mod-notes-opener-abe49d8c.js";import{P as ft}from"./pdp-a697afbf.js";import{R as gt}from"./pdp-comment-search-close-89bd49b6.js";import{s as Ct,S as yt}from"./search-params-1f957500.js";import{S as wt,a as St,b as _t}from"./search-dynamic-id-83530afd.js";import"./reddit-feed-7014e4d4.js";import"./faceplate-search-input-5cc386db.js";import"./faceplate-tooltip-c8f30589.js";import"./adjust-search-query-link-04db8451.js";import"./search-dynamic-id-cache-controller-9f0791fb.js";import"./translation-contribution-toggle-e03cb2a6.js";import"./shreddit-sort-dropdown-with-suggested-7ac6ac32.js";import"./rpl-dialog-trigger-b144b0cd.js";import"./rpl-bottom-sheet-cd589c7a.js";import"./faceplate-number-fad7f0f7.js";import"./locale-e49f0b05.js";import"./number-ea0536b9.js";import"./cached-intl-e5b35306.js";import"./faceplate-timeago-7cafbe56.js";import"./relative-date-77173042.js";import"./award-controller-8d9a9716.js";import"./awardsTelemetryState-d4244887.js";import"./comment-e175b5e4.js";import"./lightweight-0bce418d.js";import"./outbound-link-tracking-controller-c5dfa067.js";import"./classnameUtils-e77f7123.js";import"./common-ui-strings-1f1d5c0f.js";import"./achievement-modal-2cd9b6ca.js";import"./faceplate-modal-2d019896.js";import"./tab-button-5b216abd.js";import"./badge-669f9d6c.js";import"./dropdownButton-c14ba005.js";import"./tab-9862f97a.js";import"./achievements-b1f3d76c.js";import"./utils-9a347755.js";import"./faceplate-textarea-input-899c007a.js";import"./live-dfde7187.js";import"./text-input-2f7ff360.js";import"./form-common-utils-450ddffa.js";import"./faceplate-input-24154400.js";import"./input-element-c1862430.js";import"./translations-d2a1922a.js";import"./faceplate-bottom-sheet-7f90aa1b.js";import"./TinyGesture-6f7cc1aa.js";import"./post-ba5a10bc.js";import"./distinguished-tags-02527156.js";import"./comment-b3d4941e.js";import"./modActions-479f5b52.js";import"./mod-notes-a0fdaab4.js";import"./faceplate-text-input-b587df82.js";import"./popper-controller-b048cf6c.js";import"./makeEventDispatcher-28989282.js";import"./faceplate-switch-input-ff61907d.js";import"./checked-input-element-9fd8b715.js";import"./faceplate-dropdown-menu-c0544483.js";import"./faceplate-menu-1a383f12.js";import"./list-item-e0968412.js";import"./contains-1042b204.js";const kt=d(t);let Tt=class extends kt{constructor(){super(...arguments),this.commentId="",this.parentCommentPermalink="",this.postPermalink="",this.isInModQueue=!1,this.onLinkClick=(t,e)=>{this.isInModQueue&&(t.stopPropagation(),t.preventDefault(),u?.(b.ModQueuePdpLinkClick,{isFullDiscussionLink:e,parentCommentPermalink:this.parentCommentPermalink,postPermalink:this.postPermalink}))}}static get styles(){return[v,f(".single-comment-thread-toolbar {\n  align-items: center;\n  display: flex;\n  flex-flow: row nowrap;\n  font: var(--font-title-h6);\n  justify-content: space-between;\n  padding: 0.5rem 1rem;\n}\n")]}firstUpdated(){this.updateComplete.then((()=>{if(this.isInModQueue)return;const t=this.getBoundingClientRect().top;window.scrollTo({top:t-48,behavior:"auto"})}))}handleSeeFullDiscussionLink(t){this.onLinkClick(t,!0);const e=document.querySelector("shreddit-post");e&&this.trackEvent(g(e))}render(){if(!this.commentId)return;const t=this.isInModQueue?"View parent comment":"Single comment thread",s="no-underline hover:no-underline visited:no-underline text-primary";return e` <div> <div class="single-comment-thread-toolbar text-neutral-content-weak"> ${this.parentCommentPermalink?e` <a href="${this.parentCommentPermalink}" class="${s}" @click="${this.onLinkClick}"> ${t} </a> `:e` <span>${t}</span> `} <span class="flex-1 h-px mx-xs bg-tone-4" data-id="line"></span> <a href="${this.postPermalink}" class="${s}" @click="${this.handleSeeFullDiscussionLink}"> See full discussion </a> </div> </div> `}};m([h({type:String,attribute:"comment-id"})],Tt.prototype,"commentId",void 0),m([h({type:String,attribute:"parent-comment-permalink"})],Tt.prototype,"parentCommentPermalink",void 0),m([h({type:String,attribute:"post-permalink"})],Tt.prototype,"postPermalink",void 0),m([h({type:Boolean,attribute:"is-in-modqueue"})],Tt.prototype,"isInModQueue",void 0),Tt=m([p("shreddit-comments-page-tools")],Tt);const It=C(t);let At=class extends It{constructor(){super(...arguments),this.isVisible=!1}connectedCallback(){super.connectedCallback(),this.enableObserver({threshold:1})}disconnectedCallback(){super.disconnectedCallback(),this.disableObserver()}publishEvent(){u(b.TriggerCommentBlockingAuth,{source:dt.Scroll})}publishCloseEvent(){u(b.TriggerCommentBlockingAuth,{source:dt.Close})}observerIsIntersectingCallback(){this.publishEvent(),this.isVisible=!0}observerIsNotIntersectingCallback(t){const{boundingClientRect:e,rootBounds:s}=t;s&&this.isVisible&&e.top>s.bottom&&(this.isVisible=!1,this.publishCloseEvent())}render(){return e`<div></div> `}};At=m([p("cbau-trigger")],At);let xt;const Et=new Uint8Array(16);function jt(){if(!xt&&(xt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!xt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xt(Et)}var Pt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const Lt=[];for(let t=0;t<256;++t)Lt.push((t+256).toString(16).slice(1));function Ot(t,e=0){return(Lt[t[e+0]]+Lt[t[e+1]]+Lt[t[e+2]]+Lt[t[e+3]]+"-"+Lt[t[e+4]]+Lt[t[e+5]]+"-"+Lt[t[e+6]]+Lt[t[e+7]]+"-"+Lt[t[e+8]]+Lt[t[e+9]]+"-"+Lt[t[e+10]]+Lt[t[e+11]]+Lt[t[e+12]]+Lt[t[e+13]]+Lt[t[e+14]]+Lt[t[e+15]]).toLowerCase()}function Mt(t){if(!function(t){return"string"==typeof t&&Pt.test(t)}(t))throw TypeError("Invalid UUID");let e;const s=new Uint8Array(16);return s[0]=(e=parseInt(t.slice(0,8),16))>>>24,s[1]=e>>>16&255,s[2]=e>>>8&255,s[3]=255&e,s[4]=(e=parseInt(t.slice(9,13),16))>>>8,s[5]=255&e,s[6]=(e=parseInt(t.slice(14,18),16))>>>8,s[7]=255&e,s[8]=(e=parseInt(t.slice(19,23),16))>>>8,s[9]=255&e,s[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,s[11]=e/4294967296&255,s[12]=e>>>24&255,s[13]=e>>>16&255,s[14]=e>>>8&255,s[15]=255&e,s}function Dt(t,e,s){function n(t,n,i,o){var r;if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const e=[];for(let s=0;s<t.length;++s)e.push(t.charCodeAt(s));return e}(t)),"string"==typeof n&&(n=Mt(n)),16!==(null===(r=n)||void 0===r?void 0:r.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+t.length);if(a.set(n),a.set(t,n.length),a=s(a),a[6]=15&a[6]|e,a[8]=63&a[8]|128,i){o=o||0;for(let t=0;t<16;++t)i[o+t]=a[t];return i}return Ot(a)}try{n.name=t}catch(t){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}function Vt(t){return 14+(t+64>>>9<<4)+1}function Ut(t,e){const s=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(s>>16)<<16|65535&s}function $t(t,e,s,n,i,o){return Ut((r=Ut(Ut(e,t),Ut(n,o)))<<(a=i)|r>>>32-a,s);var r,a}function qt(t,e,s,n,i,o,r){return $t(e&s|~e&n,t,e,i,o,r)}function Bt(t,e,s,n,i,o,r){return $t(e&n|s&~n,t,e,i,o,r)}function Rt(t,e,s,n,i,o,r){return $t(e^s^n,t,e,i,o,r)}function Ft(t,e,s,n,i,o,r){return $t(s^(e|~n),t,e,i,o,r)}Dt("v3",48,(function(t){if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t[s]=e.charCodeAt(s)}return function(t){const e=[],s=32*t.length,n="0123456789abcdef";for(let i=0;i<s;i+=8){const s=t[i>>5]>>>i%32&255,o=parseInt(n.charAt(s>>>4&15)+n.charAt(15&s),16);e.push(o)}return e}(function(t,e){t[e>>5]|=128<<e%32,t[Vt(e)-1]=e;let s=1732584193,n=-271733879,i=-1732584194,o=271733878;for(let e=0;e<t.length;e+=16){const r=s,a=n,l=i,c=o;s=qt(s,n,i,o,t[e],7,-680876936),o=qt(o,s,n,i,t[e+1],12,-389564586),i=qt(i,o,s,n,t[e+2],17,606105819),n=qt(n,i,o,s,t[e+3],22,-1044525330),s=qt(s,n,i,o,t[e+4],7,-176418897),o=qt(o,s,n,i,t[e+5],12,1200080426),i=qt(i,o,s,n,t[e+6],17,-1473231341),n=qt(n,i,o,s,t[e+7],22,-45705983),s=qt(s,n,i,o,t[e+8],7,1770035416),o=qt(o,s,n,i,t[e+9],12,-1958414417),i=qt(i,o,s,n,t[e+10],17,-42063),n=qt(n,i,o,s,t[e+11],22,-1990404162),s=qt(s,n,i,o,t[e+12],7,1804603682),o=qt(o,s,n,i,t[e+13],12,-40341101),i=qt(i,o,s,n,t[e+14],17,-1502002290),n=qt(n,i,o,s,t[e+15],22,1236535329),s=Bt(s,n,i,o,t[e+1],5,-165796510),o=Bt(o,s,n,i,t[e+6],9,-1069501632),i=Bt(i,o,s,n,t[e+11],14,643717713),n=Bt(n,i,o,s,t[e],20,-373897302),s=Bt(s,n,i,o,t[e+5],5,-701558691),o=Bt(o,s,n,i,t[e+10],9,38016083),i=Bt(i,o,s,n,t[e+15],14,-660478335),n=Bt(n,i,o,s,t[e+4],20,-405537848),s=Bt(s,n,i,o,t[e+9],5,568446438),o=Bt(o,s,n,i,t[e+14],9,-1019803690),i=Bt(i,o,s,n,t[e+3],14,-187363961),n=Bt(n,i,o,s,t[e+8],20,1163531501),s=Bt(s,n,i,o,t[e+13],5,-1444681467),o=Bt(o,s,n,i,t[e+2],9,-51403784),i=Bt(i,o,s,n,t[e+7],14,1735328473),n=Bt(n,i,o,s,t[e+12],20,-1926607734),s=Rt(s,n,i,o,t[e+5],4,-378558),o=Rt(o,s,n,i,t[e+8],11,-2022574463),i=Rt(i,o,s,n,t[e+11],16,1839030562),n=Rt(n,i,o,s,t[e+14],23,-35309556),s=Rt(s,n,i,o,t[e+1],4,-1530992060),o=Rt(o,s,n,i,t[e+4],11,1272893353),i=Rt(i,o,s,n,t[e+7],16,-155497632),n=Rt(n,i,o,s,t[e+10],23,-1094730640),s=Rt(s,n,i,o,t[e+13],4,681279174),o=Rt(o,s,n,i,t[e],11,-358537222),i=Rt(i,o,s,n,t[e+3],16,-722521979),n=Rt(n,i,o,s,t[e+6],23,76029189),s=Rt(s,n,i,o,t[e+9],4,-640364487),o=Rt(o,s,n,i,t[e+12],11,-421815835),i=Rt(i,o,s,n,t[e+15],16,530742520),n=Rt(n,i,o,s,t[e+2],23,-995338651),s=Ft(s,n,i,o,t[e],6,-198630844),o=Ft(o,s,n,i,t[e+7],10,1126891415),i=Ft(i,o,s,n,t[e+14],15,-1416354905),n=Ft(n,i,o,s,t[e+5],21,-57434055),s=Ft(s,n,i,o,t[e+12],6,1700485571),o=Ft(o,s,n,i,t[e+3],10,-1894986606),i=Ft(i,o,s,n,t[e+10],15,-1051523),n=Ft(n,i,o,s,t[e+1],21,-2054922799),s=Ft(s,n,i,o,t[e+8],6,1873313359),o=Ft(o,s,n,i,t[e+15],10,-30611744),i=Ft(i,o,s,n,t[e+6],15,-1560198380),n=Ft(n,i,o,s,t[e+13],21,1309151649),s=Ft(s,n,i,o,t[e+4],6,-145523070),o=Ft(o,s,n,i,t[e+11],10,-1120210379),i=Ft(i,o,s,n,t[e+2],15,718787259),n=Ft(n,i,o,s,t[e+9],21,-343485551),s=Ut(s,r),n=Ut(n,a),i=Ut(i,l),o=Ut(o,c)}return[s,n,i,o]}(function(t){if(0===t.length)return[];const e=8*t.length,s=new Uint32Array(Vt(e));for(let n=0;n<e;n+=8)s[n>>5]|=(255&t[n/8])<<n%32;return s}(t),8*t.length))}));var Nt={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function zt(t,e,s){if(Nt.randomUUID&&!e&&!t)return Nt.randomUUID();const n=(t=t||{}).random||(t.rng||jt)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){s=s||0;for(let t=0;t<16;++t)e[s+t]=n[t];return e}return Ot(n)}function Qt(t,e,s,n){switch(t){case 0:return e&s^~e&n;case 1:return e^s^n;case 2:return e&s^e&n^s&n;case 3:return e^s^n}}function Ht(t,e){return t<<e|t>>>32-e}Dt("v5",80,(function(t){const e=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=[];for(let s=0;s<e.length;++s)t.push(e.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const n=t.length/4+2,i=Math.ceil(n/16),o=new Array(i);for(let e=0;e<i;++e){const s=new Uint32Array(16);for(let n=0;n<16;++n)s[n]=t[64*e+4*n]<<24|t[64*e+4*n+1]<<16|t[64*e+4*n+2]<<8|t[64*e+4*n+3];o[e]=s}o[i-1][14]=8*(t.length-1)/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=8*(t.length-1)&4294967295;for(let t=0;t<i;++t){const n=new Uint32Array(80);for(let e=0;e<16;++e)n[e]=o[t][e];for(let t=16;t<80;++t)n[t]=Ht(n[t-3]^n[t-8]^n[t-14]^n[t-16],1);let i=s[0],r=s[1],a=s[2],l=s[3],c=s[4];for(let t=0;t<80;++t){const s=Math.floor(t/20),o=Ht(i,5)+Qt(s,r,a,l)+c+e[s]+n[t]>>>0;c=l,l=a,a=Ht(r,30)>>>0,r=i,i=o}s[0]=s[0]+i>>>0,s[1]=s[1]+r>>>0,s[2]=s[2]+a>>>0,s[3]=s[3]+l>>>0,s[4]=s[4]+c>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,255&s[0],s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,255&s[1],s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,255&s[2],s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,255&s[3],s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,255&s[4]]}));const Jt=d(S(t));let Wt=class extends Jt{constructor(){super(...arguments),this.thingId="",this.postId="",this.subredditPrefixedName="",this.isTruncated=!1,this.totalComments=0,this.isProfilePost=!1,this.isReportingEnabled=!1,this.ui="mobile",this.permalink="",this.author="",this.isAuthorDeleted=!1,this.pageUnloaded=!1,this.initialViewStats={num_comments_viewed:0,comments_viewed_json:[],comments_viewed_list:[],num_comments_consumed:0,comments_consumed_json:[],comments_consumed_list:[]},this.view_stats=this.cloneObject(this.initialViewStats),this.correlation_id=zt(),this.page_request_id=k(),this.overflowActionsMenuRef=T(),this.scrollBlocker=new pt(this),this._visibilityDetails=null,this.depthUpdated=null,this.handleVisibilityChange=t=>{t?(this.pageUnloaded=!1,this.resetViewStats()):this.pageUnloaded||this.flushEvents()},this.onBeforeUnload=()=>{this.pageUnloaded=!0,this.flushEvents()},this.flushEvents=()=>{const t=I(),e=((t,e,s,n,i,o,r)=>{let a={};const l=y("post"),c=e.slice(0,1e3);return a={correlation_id:i,translation_metrics:r,view_stats:{num_comments_viewed:t,comments_viewed_json:JSON.stringify(c),comments_viewed_list:s},post:{...l,number_comments:n},action_info:{page_request_id:o}},w({source:"post",action:"view",noun:"comments"},a)})(this.view_stats.num_comments_viewed,this.view_stats.comments_viewed_json,this.view_stats.comments_viewed_list,this.totalComments,this.correlation_id,this.page_request_id,t),s=((t,e,s,n,i,o,r)=>{let a={};const l=y("post"),c=e.slice(0,1e3);return a={correlation_id:i,translation_metrics:r,view_stats:{num_comments_consumed:t,comments_consumed_json:JSON.stringify(c),comments_consumed_list:s},post:{...l,number_comments:n},screen:{height:window?.screen.height,width:window?.screen.width},action_info:{page_request_id:o}},w({source:"post",action:"consume",noun:"comments"},a)})(this.view_stats.num_comments_consumed,this.view_stats.comments_consumed_json,this.view_stats.comments_consumed_list,this.totalComments,this.correlation_id,this.page_request_id,t);this.trackEvent(e),this.trackEvent(s),this.resetViewStats()},this.commentsViewedListener=t=>{this.updateCommentsViewedStats(t.detail)},this.commentsConsumedListener=t=>{this.updateCommentsConsumedStats(t.detail)},this.handleCloseOverflowActionsMenu=()=>{this.overflowActionsMenuRef.value?.close(),document.documentElement.removeEventListener("click",this.handleCloseOverflowActionsMenu),this.scrollBlocker.unblockPageScrolling()},this.handleCommentCreated=({parentThingId:t,body:e})=>{this.postId===t&&e&&(this.querySelector("#next-comment")?.after(...A(e)),this.totalComments+=1)}}static get styles(){return[v,f(":host {\n  display: block;\n  background-color: var(--shreddit-content-background);\n  padding-bottom: var(--spacer-xs);\n}\n"),f(mt)]}get visibilityDetails(){return null===this._visibilityDetails&&null===this.depthUpdated&&(this.depthUpdated=new Promise((t=>{requestAnimationFrame((()=>{const e=this.getVisibilityDetails();this._visibilityDetails=e,t(e)}))}))),this._visibilityDetails}getVisibilityDetails({containerWidth:t}={}){const e=this.querySelector(":scope > shreddit-comment")?.depth??0;t??(t=this.getBoundingClientRect().width);const s="mobile"===this.ui?232:320,n="mobile"===this.ui?18:32,i="mobile"===this.ui?4:10,o=Math.floor((t-s)/n),r=Math.max(1,Math.min(o,i)),a=r+e,l=this.querySelector(":scope shreddit-comment[is-chosen-mq-comment]"),c=l?.depth??0,d=Math.max(e,c-r+1);return l?{maxVisibleDepth:d+r,minVisibleDepth:d}:{maxVisibleDepth:a}}cloneObject(t){return JSON.parse(JSON.stringify(t))}connectedCallback(){at(this.shadowRoot),super.connectedCallback(),this.addEventListener(lt,this.handleOpenOverflowActionsMenu),this.subscribe(b.CommentCreated,this.handleCommentCreated),this.resizeObserver=new ResizeObserver(ct((t=>{let e=0;for(const s of t){const t=s.contentBoxSize.at(0)?.inlineSize;if(t){e=t;break}}if(0===e)return;const s=this.getVisibilityDetails({containerWidth:e});if(this._visibilityDetails?.maxVisibleDepth!==s.maxVisibleDepth||this._visibilityDetails?.minVisibleDepth!==s.minVisibleDepth){this._visibilityDetails=s,this.depthUpdated=Promise.resolve(s);for(const t of this.querySelectorAll("shreddit-comment"))t.setVisibility(s.maxVisibleDepth,s.minVisibleDepth)}}),128,!0)),this.resizeObserver.observe(this,{box:"content-box"}),this.addEventListener("comments-viewed-event",this.commentsViewedListener),this.addEventListener("comments-consumed-event",this.commentsConsumedListener),x.subscribe(this.onBeforeUnload,{unloadOnly:!0}),E(this.handleVisibilityChange,{immediate:!0}),window.addEventListener("beforeRoute",this.flushEvents)}resetViewStats(){this.correlation_id=zt(),this.view_stats=this.cloneObject(this.initialViewStats)}updateCommentsViewedStats(t){return this.view_stats.comments_viewed_json.find((e=>e.comment_id===t?.detail.comment_id))||(this.view_stats.comments_viewed_json.push({comment_depth:t?.detail.comment_depth,comment_id:t?.detail.comment_id,comment_parent_id:t?.detail.comment_parent_id}),this.view_stats.comments_viewed_list.push(t?.detail.comment_id),this.view_stats.num_comments_viewed=this.view_stats.comments_viewed_json.length),t}updateCommentsConsumedStats(t){return this.view_stats.comments_consumed_json.find((e=>e.comment_id===t?.detail.comment_id))||(this.view_stats.comments_consumed_json.push({comment_depth:t?.detail.comment_depth,comment_id:t?.detail.comment_id,comment_parent_id:t?.detail.comment_parent_id}),this.view_stats.comments_consumed_list.push(t?.detail.comment_id),this.view_stats.num_comments_consumed=this.view_stats.comments_consumed_json.length),t}disconnectedCallback(){super.disconnectedCallback(),x.unsubscribe(this.onBeforeUnload),this.removeEventListener(lt,this.handleOpenOverflowActionsMenu),this.unsubscribe(b.CommentCreated,this.handleCommentCreated),this.resizeObserver?.unobserve(this),this.resizeObserver?.disconnect(),this.removeEventListener("comments-viewed-event",this.commentsViewedListener),this.removeEventListener("comments-consumed-event",this.commentsConsumedListener),window.removeEventListener("beforeRoute",this.flushEvents)}showAllComments(){this.publish(b.TriggerCommentBlockingAuth,{source:dt.Button}),this.isTruncated=!1,this.trackEvent(ut())}renderShredtopViewMoreCommentsButton(t){return j({attributes:{type:"button",className:"ml-sm xs:ml-0 font-semibold mt-md",onclick:t},appearance:"brand",shape:"pill",leadingIcon:s({size:n.Medium}),size:P.Small,children:"View more comments"})}renderTruncatedExpandButton(){return this.renderShredtopViewMoreCommentsButton(this.showAllComments)}renderContent(){return function(t,e){const s="Comments Section";return t` <section class="flex flex-col px-md xs:px-0 gap-md relative" aria-label="Comments"> <h1 class="absolute -top-full -left-full w-px h-px overflow-hidden" aria-label="${s}"> ${s} </h1> <slot></slot> ${e?"":t`<slot name="truncated"></slot>`} </section> `}(e,this.isTruncated)}renderExpandButton(){return this.isTruncated?this.renderTruncatedExpandButton():""}render(){return e` ${this.renderContent()} <faceplate-dialog ${L(this.overflowActionsMenuRef)} class="overflow-actions-dialog" @click="${this.handleCloseOverflowActionsMenu}"> <faceplate-screen-reader-content id="overflow-actions-menu-label"> Additional comment actions </faceplate-screen-reader-content> <ul class="overflow-actions-menu" aria-labelledby="overflow-actions-menu-label"> <li> <a href="${this.permalink}"> <icon-link-post aria-hidden="true" class="overflow-actions-icon"></icon-link-post> Share </a> </li> ${this.isProfilePost?"":e` <li> <a href="/${this.subredditPrefixedName}/"> <icon-admin aria-hidden="true" class="overflow-actions-icon"></icon-admin> More from ${this.subredditPrefixedName} </a> </li> `} ${this.isAuthorDeleted?"":e`<li> <a href="/user/${this.author}/"> <icon-user aria-hidden="true" class="overflow-actions-icon"></icon-user> ${this.author}'s profile </a> </li>`} ${this.isReportingEnabled?e`<li> <shreddit-overflow-report thingId="${this.thingId}" type="${ht.COMMENT}"></shreddit-overflow-report> </li>`:""} <button class="button button-small button-plain block bg-tone-6 text-tone-3 mt-[10px] mx-auto mb-0 w-[calc(100%-20px)] max-w-full"> Close </button> </ul> </faceplate-dialog> ${this.renderExpandButton()} `}handleOpenOverflowActionsMenu({detail:{author:t,isAuthorDeleted:e,permalink:s,thingId:n}}){this.author=t,this.isAuthorDeleted=e,this.permalink=s,this.thingId=n,this.overflowActionsMenuRef.value?.showModal(),document.documentElement.addEventListener("click",this.handleCloseOverflowActionsMenu),this.scrollBlocker.blockPageScrolling()}};m([h({type:String})],Wt.prototype,"thingId",void 0),m([h({type:String,attribute:"post-id"})],Wt.prototype,"postId",void 0),m([h({type:String,attribute:"subreddit-prefixed-name"})],Wt.prototype,"subredditPrefixedName",void 0),m([h({type:Boolean})],Wt.prototype,"isTruncated",void 0),m([h({type:Number})],Wt.prototype,"totalComments",void 0),m([h({type:Boolean})],Wt.prototype,"isProfilePost",void 0),m([h({type:Boolean,attribute:"is-reporting-enabled"})],Wt.prototype,"isReportingEnabled",void 0),m([h({type:String,attribute:"ui"})],Wt.prototype,"ui",void 0),m([_()],Wt.prototype,"permalink",void 0),m([_()],Wt.prototype,"author",void 0),m([_()],Wt.prototype,"isAuthorDeleted",void 0),Wt=m([p("shreddit-comment-tree")],Wt);let Kt=class extends t{constructor(){super(),this.postId="",this.handleCommentCreated=({postId:t})=>{t===this.postId&&this.remove()},this.pubsub=new O(this)}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.CommentCreated,this.handleCommentCreated)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.CommentCreated,this.handleCommentCreated)}render(){return e`<slot></slot>`}};Kt.styles=[i`:host{display:contents}`,v],m([h({type:String,attribute:"post-id"})],Kt.prototype,"postId",void 0),Kt=m([p("comment-forest-empty-state")],Kt);let Zt=class extends bt{constructor(){super(...arguments),this.mtSeoLanguage="",this.isSeoVisit=!1,this.withInterventionModal=!1,this.isLoadingTranslations=!1,this._partialRequestController=new M(this),this.seoVisitSettled=!1,this.pubsub=new O(this),this.onPostTranslationOverride=t=>{"PDP"===t.pageType&&(t.isContextUpdateEvent||(t.isTranslationActive?this.onTranslationsEnabled():this.onTranslationsDisabled()))},this.onCommentTranslationOverride=t=>{this.onCommentTranslationToggle(t.id,t.isTranslationActive)}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride,!1),this.pubsub.subscribe(b.I18nCommentTranslationOverride,this.onCommentTranslationOverride,!1),this.addEventListener(D,this.handleTranslationFeedback),this.addEventListener("faceplate-load",this.handleCommmentPartialsLoaded)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride),this.pubsub.unsubscribe(b.I18nCommentTranslationOverride,this.onCommentTranslationOverride),this.removeEventListener(D,this.handleTranslationFeedback),this.removeEventListener("faceplate-load",this.handleCommmentPartialsLoaded)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}async onCommentTranslationToggle(t,e){const s=this.getCommentMetadataById(t);if(!s||!s.isTranslatable)return;const n=this.objectTranslationCache.get(t);if(!(e?!!n?.translatedElement:!!n?.originalElement)){const s=await this.fetchComments([t],e?"translated":"original");this.storeCommentTranslationCache(s)}this.renderTranslationCache(e,t)}async onTranslationsEnabled(){const t=await this.runTranslations(!0);V(!0),U(!0,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async onTranslationsDisabled(){const t=await this.runTranslations(!1);V(!1),U(!1,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async runTranslations(t){const e=t??!!this.translationContextValue.isTranslationActive,s=this.getCommentsMetadata();this.storeCommentTranslationCache(s.map((t=>({id:t.id,translation:t.isTranslated?t.slot.innerHTML:void 0,original:t.isTranslated?void 0:t.slot.innerHTML}))));const n=[];this.objectTranslationCache.forEach(((t,s)=>{(e&&!t.translatedElement||!e&&!t.originalElement)&&n.push(s)}));let i=[];return n.length&&(i=await this.fetchComments(n,e?"translated":"original"),this.storeCommentTranslationCache(i||[])),this.renderTranslationCache(e),{fetchedComments:i}}getCommentMetadataById(t){const e=this.querySelector(`shreddit-comment[thingid="${t}"]`);if(e)return this.getCommentMetadata(e)}getCommentsMetadata(){const t=this.querySelectorAll("shreddit-comment");return Array.from(t).filter((t=>{const e=t.getAttribute("thingid"),s=null!==t.getAttribute("is-translatable"),n=t.querySelector('div[slot="comment"]');return!!e&&s&&!!n})).map((t=>this.getCommentMetadata(t)))}getCommentMetadata(t){return{id:t.getAttribute("thingid"),isTranslated:null!==t.getAttribute("is-comment-translated"),isTranslatable:null!==t.getAttribute("is-translatable"),element:t,slot:t.querySelector('div[slot="comment"]'),cache:this.objectTranslationCache.get(t.getAttribute("thingid"))}}async fetchComments(t,e){const s=new FormData;t.forEach((t=>s.append("commentIds[]",t))),s.append("includeTranslation","translated"===e?"true":"false");const n=await this.fetchRequestPartial("/svc/shreddit/translated-comment/",{method:$.Post,body:s});return n?this.parseFetchCommentResponse(n):[]}parseFetchCommentResponse(t){return t.map((t=>{const e=t.getAttribute("data-comment-id"),s=t.querySelector(`[data-translated-comment-id="${e}"]`)?.querySelector(`#${e}-translated-post-rtjson-content`),n=t.querySelector(`[data-original-comment-id="${e}"]`)?.querySelector(`#${e}-post-rtjson-content`),i=t=>t?`<div class="py-0 xs:mx-xs mx-2xs inline-block">${t}</div>`:void 0;return{id:e,original:i(n?.innerHTML),translation:i(s?.innerHTML)}}))}storeCommentTranslationCache(t){t.forEach((t=>{this.updateTranslationCache(t.id,{originalElement:t.original?{content:t.original}:void 0,translatedElement:t.translation?{content:t.translation}:void 0})}))}renderTranslationCache(t,e){const s=t??!!this.translationContextValue.isTranslationActive;(e?[this.getCommentMetadataById(e)]:this.getCommentsMetadata()).filter((t=>t&&t.isTranslated!==s&&(s?!!t.cache?.translatedElement:!!t.cache?.originalElement))).forEach((t=>{const e=s?t.cache.translatedElement:t.cache.originalElement;t.slot.innerHTML=e?.content||"",s?t.element.setAttribute("is-comment-translated","true"):t.element.removeAttribute("is-comment-translated")}))}handleTranslationFeedback(t){const{postId:e,commentId:s}=t.detail,n=document.querySelector("shreddit-post"),i=n?.querySelector('[slot="title"]'),o=n?.querySelector('[slot="text-body"]'),r=this.shadowRoot?.getElementById(q.ID.PDP_COMMENT_FEEDBACK_MODAL);r&&r.show?.({post:{id:vt(e),title:i?.textContent?.trim(),body_text:o?.textContent?.trim(),translation_state:this.translationContextValue.isTranslationActive},comment:{id:s,post_id:vt(e),translation_state:this.translationContextValue.isTranslationActive}})}toggleObserverForComments(t){t?.forEach((t=>{const e=document.querySelector(`shreddit-comment[thingid="${t.id}"]`);e&&e?.addTranslationToggledObserver?.('div[slot="comment"]')}))}submitTranslationMetrics(t){if(!this.reportMetrics)return;const e=this.querySelectorAll("shreddit-comment"),s=this.translationContextValue?.isTranslationActive||!1,n={},i=[];e.length&&Array.from(e).filter((t=>{const e=this.getCommentMetadata(t);if(!t||!e)return;const n=e.slot?.textContent||"",o=e.cache;let r=s?"":n,a=s?n:"";o&&(r=o.originalElement?.content||r,a=o.translatedElement?.content||a),i.push({id:e.id,originalBody:r,translatedBody:a,isTranslated:e.isTranslated,isTranslatable:e.isTranslatable})})),n.scenario=t||this.metricsScenario,n.comments=B(s,i),this.dispatchEvent(R(F,n))}handleCommmentPartialsLoaded(t){"faceplate-load"===t.type&&this.translationContextValue.isTranslationActive&&"src"in t.detail&&t.detail.src.startsWith("/svc/shreddit/more-comments/")&&t.detail.src.includes("translated=1")&&(this.submitTranslationMetrics(N.LoadMore),this.pubsub.publish(b.I18nMoreCommentsPostMetrics,{}))}render(){return e` <div><slot></slot></div> ${this.withInterventionModal?e`<translation-intervention-modal mode="comment" page-type="pdp" ?is-immersive-visit="${this.isImmersiveVisit}"></translation-intervention-modal>`:o} <translation-feedback-modal id="${q.ID.PDP_COMMENT_FEEDBACK_MODAL}"></translation-feedback-modal> `}};m([h({type:String,attribute:"mt-seo-language"})],Zt.prototype,"mtSeoLanguage",void 0),m([h({type:Boolean,attribute:"is-seo-visit"})],Zt.prototype,"isSeoVisit",void 0),m([h({type:Boolean,attribute:"is-immersive-visit"})],Zt.prototype,"isImmersiveVisit",void 0),m([h({type:Boolean,attribute:"with-intervention-modal"})],Zt.prototype,"withInterventionModal",void 0),Zt=m([p("comment-translator")],Zt);let Gt=class extends t{constructor(){super(),this.target="",this.path="",this.replaceComments=async({sort:t="",filter:e="",entityFilterId:s=""})=>{t!==this.getCurrentSort()&&this.updateLocation({sort:t});const n=new URL(`${location.origin}${this.path}`);t&&n.searchParams.set(ft.Sort,t.toLowerCase()),e&&n.searchParams.set(ft.Filter,e.toLowerCase()),s&&n.searchParams.set(ft.EntityFilterId,s),n.searchParams.set(ft.InlineRefresh,"true");const i=n.toString().substring(location.origin.length);this.replaceContentController.loadAndReplaceContent({src:i,target:this.target,afterSuccess:()=>z(this,{message:"The comments are sorted successfully",options:{priority:Q.assertive}}),afterFailure:()=>this.dispatchEvent(R("faceplate-alert",{level:H.error,message:"Failed to load the comments."}))})},this.handleCommentFilterUpdated=({sort:t,filter:e,entityFilterId:s})=>{let n=s;s&&s===this.getCurrentEntityFilterId()&&(n=void 0),this.replaceComments({entityFilterId:n,filter:e??this.getCurrentFilter(),sort:t??this.getCurrentSort()})},this.handleSortEvent=async t=>{this.replaceComments({sort:t.detail.selected?.toLowerCase(),filter:this.getCurrentFilter()}),this.pubsub.publish(b.CommentSort,{sort:t.detail.selected})},this.handleClickEvent=async t=>{const e=t.target?.getAttribute("value");e&&(this.replaceComments({filter:e,sort:this.getCurrentSort()}),t.preventDefault())},this.replaceContentController=new gt,this.pubsub=new O(this)}updateLocation({sort:t}){const e=new URL(location.href);e.searchParams.set(ft.Sort,t.toLowerCase()),history.replaceState({},"",e.toString())}getCurrentFilter(){return this.querySelector("[faceplate-tab-selected]")?.getAttribute("value")?.toLowerCase()||""}getCurrentSort(){return new URLSearchParams(location.search).get(ft.Sort)||""}getCurrentEntityFilterId(){return document.querySelector("named-entity-filter-group")?.activeEntityFilterId}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.CommentFilterUpdated,this.handleCommentFilterUpdated),this.querySelector("shreddit-sort-dropdown")?.addEventListener("comment-sort",this.handleSortEvent),this.querySelector("shreddit-sort-dropdown-with-suggested")?.addEventListener("comment-sort",this.handleSortEvent),this.querySelector("faceplate-tabgroup")?.addEventListener("click",this.handleClickEvent)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.CommentFilterUpdated,this.handleCommentFilterUpdated),this.querySelector("shreddit-sort-dropdown")?.removeEventListener("comment-sort",this.handleSortEvent),this.querySelector("shreddit-sort-dropdown-with-suggested")?.removeEventListener("comment-sort",this.handleSortEvent),this.querySelector("faceplate-tabgroup")?.removeEventListener("click",this.handleClickEvent)}render(){return e`<slot></slot>`}};m([h({type:String})],Gt.prototype,"target",void 0),m([h({type:String})],Gt.prototype,"path",void 0),Gt=m([p("shreddit-comments-sort-dropdown")],Gt);let Yt=class extends t{constructor(){super(...arguments),this.target="",this.path="",this.showOnLoad=!1,this.initialValue="",this.commentComposerSelector=W.commentComposerHost,this.addCommentButton=W.addCommentButton,this.pdpCommentsSortSelector=W.pdpCommentsTreeSortContainer,this.pdpAmaCommentTabSelector=W.pdpAmaCommentTabWrapper,this.shredditCommentsSortSelector=W.shredditCommentsSortDropdown,this.open=this.showOnLoad,this.commentSearchActive=this.showOnLoad,this.focusSearchInput=()=>{this.open||(this.open=!0),this.searchInput?.innerInput?.focus()},this.resetSearchInput=()=>{this.handleClear(),this.open=!1,wt.update(K.PdpCommentSearch),this.commentSearchActive=!1,this.expandSearchButton?.focus()},this.replaceContentController=new gt,this.handlePdpCommentSearch=Z((async()=>{const t=this.searchInput?.value??"";if(t){this.commentSearchActive=!0;const e={conversationId:St.get(K.PdpCommentSearch),cursor:{},impressionId:wt.getUUID(),pane:G.Comments,query:t,scope:{type:Y.PDP,path:this.path}};this.addSearchParamsToUrl(e);const s=new URLSearchParams({...Ct(e)});X(this,w({source:"search",action:"click",noun:"full_search_button"},this.searchTelemetryData));const n=document.createElement("span");n.id=this.target,this.replaceContentController.loadAndReplaceContent({src:`/svc/shreddit${this.path}pdp-comment-search-results?${s.toString()}`,target:this.target,wrapPartialElement:t=>(n.appendChild(t),n)})}}),300),this.handleKeyDown=t=>{wt.update(K.PdpCommentSearch),"Enter"===t.key&&t.target===this.searchInput&&this.handlePdpCommentSearch(),"Escape"===t.key&&t.target===this.searchInput&&(t.stopPropagation(),this.commentSearchActive?this.searchInput?.blur():this.resetSearchInput())},this.handleClear=()=>{this.searchInput?.value&&(this.searchInput.value="")}}hideElementsVisibility(t){document.querySelector(this.commentComposerSelector)?.classList.toggle("hidden",t),document.querySelector(this.addCommentButton)?.classList.toggle("hidden",t),document.querySelector(this.pdpCommentsSortSelector)?.classList.toggle("hidden",t),document.querySelector(this.pdpAmaCommentTabSelector)?.classList.toggle("hidden",t),document.querySelector(this.shredditCommentsSortSelector)?.classList.toggle("flex",!t)}connectedCallback(){super.connectedCallback(),this.commentSearchActive=this.showOnLoad,this.open=this.showOnLoad,this.hideElementsVisibility(this.showOnLoad)}get searchTelemetryData(){const t=this.searchInput?.value??"";return{action_info:{page_type:tt.PostDetail},search:{conversation_id:St.get(K.PdpCommentSearch),impression_id:wt.get(K.PdpCommentSearch),query:t,query_id:_t.get({query:t,scope:{type:Y.PDP,path:this.path}},K.PdpCommentSearch),origin_element:et.CommentSearchBar,origin_page_type:tt.PostDetail}}}addSearchParamsToUrl(t){const e=location.href,s=new URL(e);s.searchParams.set(yt.Query,t.query),s.searchParams.set(yt.Pane,G.Comments),s.searchParams.set(yt.ConversationId,t.conversationId??St.get(K.PdpCommentSearch)),s.searchParams.set(yt.ImpressionId,t.impressionId??wt.getUUID());const n=s.toString();n!==e&&history.replaceState({},"",n)}updated(t){if(t.has("open")){const e=!t.get("open")&&this.open,s=t.get("open")&&!this.open;e?this.focusSearchInput():s&&this.expandSearchButton?.focus()}this.hideElementsVisibility(this.commentSearchActive||this.open)}render(){const t="Search Comments";return e`<div class="block ml-xs" data-faceplate-tracking-context="${JSON.stringify(this.searchTelemetryData)}"> <faceplate-tracker source="search" action="click" noun="search_bar"> ${j({appearance:"bordered",attributes:{"aria-controls":"pdp-comment-search-form","aria-expanded":`${this.open}`,className:"border-neutral-border-weak hover:border-neutral-content-weak text-secondary-weak font-normal "+(this.open?"hidden":""),id:"expand-pdp-comment-search-button",onclick:this.focusSearchInput,type:"button"},children:e`<span class="flex pr-xs">${t}</span>`,leadingIcon:e`<span class="flex pl-xs">${r({size:n.Small})}</span>`,screenReaderContent:"Expand comment search"})} </faceplate-tracker> <form class="flex w-full ${st({hidden:!this.open})}" id="pdp-comment-search-form" @submit="${this.handlePdpCommentSearch}"> <faceplate-search-input class="text-secondary-plain m-0 rounded-full outline outline-1 outline-neutral-border-weak flex-grow focus:outline-neutral-content-weak" placeholder="${t}" enterkeyhint="search" @keydown="${this.handleKeyDown}" @focus="${()=>{this.open=!0}}" value="${this.initialValue}"> ${j({attributes:{id:"search-input-clear-button",slot:"clearIcon",type:"button",onclick:this.handleClear},appearance:"plain",size:P.Small,screenReaderContent:"Clear search",leadingIcon:a({size:n.Small})})}</faceplate-search-input> ${j({appearance:"plain",attributes:{className:"ml-xs"+(this.commentSearchActive?" hidden":""),id:"cancel-pdp-comment-search-button",onclick:this.resetSearchInput,type:"button"},children:"Cancel"})} </form> </div>`}};Yt.styles=[v],m([h({type:String})],Yt.prototype,"target",void 0),m([h({type:String})],Yt.prototype,"path",void 0),m([h({attribute:"show-on-load",type:Boolean})],Yt.prototype,"showOnLoad",void 0),m([h({type:String,attribute:"initial-value"})],Yt.prototype,"initialValue",void 0),m([h({type:String,attribute:"comment-composer-selector"})],Yt.prototype,"commentComposerSelector",void 0),m([h({type:String,attribute:"add-comment-button"})],Yt.prototype,"addCommentButton",void 0),m([h({type:String,attribute:"pdp-comments-sort-selector"})],Yt.prototype,"pdpCommentsSortSelector",void 0),m([h({type:String,attribute:"pdp-ama-comments-tab-selector"})],Yt.prototype,"pdpAmaCommentTabSelector",void 0),m([h({type:String,attribute:"shreddit-comments-sort-dropdown-selector"})],Yt.prototype,"shredditCommentsSortSelector",void 0),m([J("#expand-pdp-comment-search-button")],Yt.prototype,"expandSearchButton",void 0),m([J("faceplate-search-input")],Yt.prototype,"searchInput",void 0),m([_()],Yt.prototype,"open",void 0),m([_()],Yt.prototype,"commentSearchActive",void 0),Yt=m([p("pdp-comment-search-input")],Yt);let Xt=class extends t{constructor(){super(...arguments),this.commentId="",this.dedupe=!1,this.shouldTrackPosition=!1,this.pubsub=new O(this),this.loadInAd=()=>{const t=this.shouldTrackPosition?this:this.shadowRoot;if(!t||t.childNodes.length>0)return;const e=document.querySelector(`shreddit-comment-tree-ads > template#comment-tree-ad_${this.commentId}`),s=e?.content.querySelector("shreddit-comments-page-ad");e&&s&&this.isNotADuplicate(s)&&(t.replaceChildren(e.content.cloneNode(!0)),s.hasAttribute("is-blank")||this.removeAttribute("class"))},this.isNotADuplicate=t=>{if(!this.dedupe||t.hasAttribute("is-blank"))return!0;const e=document.querySelector("shreddit-comments-page-ad");return!e||t.getAttribute("campaign-id")!==e.getAttribute("campaign-id")}}createRenderRoot(){return this.shouldTrackPosition?this:super.createRenderRoot()}connectedCallback(){super.connectedCallback(),this.commentId&&(this.loadInAd(),this.pubsub.subscribe(b.CommentTreeAdsLoaded,this.loadInAd))}disconnectedCallback(){this.commentId&&this.pubsub.unsubscribe(b.CommentTreeAdsLoaded,this.loadInAd),super.disconnectedCallback()}render(){return o}};Xt.styles=[v],m([h({type:String,attribute:"comment-id"})],Xt.prototype,"commentId",void 0),m([h({type:Boolean,attribute:"dedupe"})],Xt.prototype,"dedupe",void 0),m([h({type:Boolean,attribute:"should-track-position"})],Xt.prototype,"shouldTrackPosition",void 0),Xt=m([p("shreddit-comment-tree-ad")],Xt);let te=class extends t{constructor(){super(...arguments),this.translationContextValue=it,this.isCommentPretranslated=!1,this.pubsub=new O(this),this.onPostTranslationOverride=t=>{(t.id===this.postId||t.isContextUpdateEvent)&&(this.postTranslationOverrideActive=t.isTranslationActive,this.commentTranslationOverrideActive=void 0)},this.onCommentTranslationOverride=t=>{t.id===this.commentId&&(this.commentTranslationOverrideActive=t.isTranslationActive)}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.I18nCommentTranslationOverride,this.onCommentTranslationOverride,!1),this.pubsub.subscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride,!1),this.isMTSEOUserPage=ot(),this.globalSetting=this.isCommentPretranslated||this.isMTSEOUserPage}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.I18nCommentTranslationOverride,this.onCommentTranslationOverride),this.pubsub.unsubscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride)}render(){const t=this.postTranslationOverrideActive,s=this.commentTranslationOverrideActive,i="boolean"==typeof t?"boolean"==typeof s&&s!==t:"boolean"==typeof s&&s!==this.globalSetting,r=!!i&&!s;return i?e`<div class="flex items-center text-neutral-content-weak" data-testid="comment-translation-status-icon"> ${!!i&&s?l({size:n.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-translated-icon","aria-label":"Comment is translated"}}):o} ${r?c({size:n.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-original-icon","aria-label":"Comment is in original language",className:r?"":"hidden"}}):o} </div>`:o}};te.styles=[v],m([nt({context:rt,subscribe:!0}),_()],te.prototype,"translationContextValue",void 0),m([_()],te.prototype,"commentTranslationOverrideActive",void 0),m([_()],te.prototype,"postTranslationOverrideActive",void 0),m([_()],te.prototype,"isMTSEOUserPage",void 0),m([_()],te.prototype,"globalSetting",void 0),m([h({type:String,attribute:"comment-id"})],te.prototype,"commentId",void 0),m([h({type:String,attribute:"post-id"})],te.prototype,"postId",void 0),m([h({type:Boolean,attribute:"comment-pretranslated"})],te.prototype,"isCommentPretranslated",void 0),te=m([p("comment-translation-status-icon")],te);
//# sourceMappingURL=comment-forest-client-js-3d5739c6.js.map
